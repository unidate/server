#
# Basic CREATE functionality, defaults, metadata
#
CREATE TABLE t1 (a INET6 AUTO_INCREMENT);
ERROR 42000: Incorrect column specifier for column 'a'
CREATE TABLE t1 (a INET6);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DESCRIBE t1;
Field	Type	Null	Key	Default	Extra
a	inet6	YES		NULL	
SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE table_schema='test' AND table_name='t1';
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	a
ORDINAL_POSITION	1
COLUMN_DEFAULT	NULL
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::1');
SELECT * FROM t1;
Catalog	Database	Table	Table_alias	Column	Column_alias	Type	Length	Max length	Is_null	Flags	Decimals	Charsetnr
def	test	t1	t1	a	a	254	39	3	Y	160	0	8
a
::1
SELECT CAST('::' AS INET6) AS a;
Catalog	Database	Table	Table_alias	Column	Column_alias	Type	Length	Max length	Is_null	Flags	Decimals	Charsetnr
def					a	254	39	2	N	33	0	8
a
::
DROP TABLE t1;
CREATE TABLE t1 (
c1 INET6 DEFAULT 0x00000000000000000000000000000000,
c2 INET6 DEFAULT 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF,
c3 INET6 DEFAULT '::',
c4 INET6 DEFAULT 'FFFF::ffff'
);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c1` inet6 DEFAULT '::',
  `c2` inet6 DEFAULT 'ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff',
  `c3` inet6 DEFAULT '::',
  `c4` inet6 DEFAULT 'ffff::ffff'
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DESCRIBE t1;
Field	Type	Null	Key	Default	Extra
c1	inet6	YES		::	
c2	inet6	YES		ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff	
c3	inet6	YES		::	
c4	inet6	YES		ffff::ffff	
SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE table_schema='test' AND table_name='t1';
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	c1
ORDINAL_POSITION	1
COLUMN_DEFAULT	'::'
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	c2
ORDINAL_POSITION	2
COLUMN_DEFAULT	'ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff'
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	c3
ORDINAL_POSITION	3
COLUMN_DEFAULT	'::'
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	c4
ORDINAL_POSITION	4
COLUMN_DEFAULT	'ffff::ffff'
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
DROP TABLE t1;
CREATE TABLE t1 (c1 INET6 DEFAULT 0x00);
ERROR 42000: Invalid default value for 'c1'
CREATE TABLE t1 (c1 INET6 DEFAULT '');
ERROR 42000: Invalid default value for 'c1'
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('x');
ERROR 22007: Incorrect inet6 value: 'x' for column `test`.`t1`.`a` at row 1
INSERT INTO t1 VALUES (1);
ERROR 22007: Incorrect inet6 value: '1' for column `test`.`t1`.`a` at row 1
INSERT INTO t1 VALUES (TIME'10:20:30');
ERROR 22007: Incorrect inet6 value: '10:20:30' for column `test`.`t1`.`a` at row 1
INSERT INTO t1 VALUES (0x00);
ERROR 22007: Incorrect inet6 value: '\x00' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
#
# Text and binary formats, comparison operators
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES (0x00000000000000000000000000000000);
INSERT INTO t1 VALUES (0x00000000000000000000000000000001);
INSERT INTO t1 VALUES (0xFFFF0000000000000000000000000001);
INSERT INTO t1 VALUES (0xFFFF0000000000000000000000000002);
SELECT * FROM t1 ORDER BY a;
a
::
::1
ffff::1
ffff::2
SELECT * FROM t1 ORDER BY a DESC;
a
ffff::2
ffff::1
::1
::
SELECT HEX(a),a FROM t1 ORDER BY a;
HEX(a)	a
00000000000000000000000000000000	::
00000000000000000000000000000001	::1
FFFF0000000000000000000000000001	ffff::1
FFFF0000000000000000000000000002	ffff::2
SELECT * FROM t1 WHERE a='::';
a
::
SELECT * FROM t1 WHERE a='::1';
a
::1
SELECT * FROM t1 WHERE a='ffff::1';
a
ffff::1
SELECT * FROM t1 WHERE a='ffff::2';
a
ffff::2
SELECT * FROM t1 WHERE a=0x00000000000000000000000000000000;
a
::
SELECT * FROM t1 WHERE a=0x00000000000000000000000000000001;
a
::1
SELECT * FROM t1 WHERE a=0xffff0000000000000000000000000001;
a
ffff::1
SELECT * FROM t1 WHERE a=0xffff0000000000000000000000000002;
a
ffff::2
SELECT * FROM t1 WHERE a<'::';
a
SELECT * FROM t1 WHERE a<='::';
a
::
SELECT * FROM t1 WHERE a>='ffff::2';
a
ffff::2
SELECT * FROM t1 WHERE a>'ffff::2';
a
SELECT * FROM t1 WHERE a IN ('::', 'ffff::1') ORDER BY a;
a
::
ffff::1
SELECT * FROM t1 WHERE a IN ('::', 0xffff0000000000000000000000000002) ORDER BY a;
a
::
ffff::2
SELECT * FROM t1 WHERE a='0::0';
a
::
SELECT * FROM t1 WHERE a='0::00';
a
::
SELECT * FROM t1 WHERE a='0::000';
a
::
SELECT * FROM t1 WHERE a='0::0000';
a
::
SELECT * FROM t1 WHERE a=0;
ERROR HY000: Illegal parameter data types inet6 and int for operation '='
SELECT * FROM t1 WHERE a=0.0;
ERROR HY000: Illegal parameter data types inet6 and decimal for operation '='
SELECT * FROM t1 WHERE a=0e0;
ERROR HY000: Illegal parameter data types inet6 and double for operation '='
SELECT * FROM t1 WHERE a=TIME'10:20:30';
ERROR HY000: Illegal parameter data types inet6 and time for operation '='
SELECT * FROM t1 WHERE a IN ('::', 10);
ERROR HY000: Illegal parameter data types inet6 and int for operation 'in'
DROP TABLE t1;
#
# CASE abbreviations
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES (NULL),('::1'),('::2');
SELECT COALESCE(a, '::') FROM t1 ORDER BY a;
COALESCE(a, '::')
::
::1
::2
SELECT a, LEAST(a,'::0'), LEAST(a,'::f') FROM t1 ORDER BY a;
a	LEAST(a,'::0')	LEAST(a,'::f')
NULL	NULL	NULL
::1	::	::1
::2	::	::2
SELECT a, GREATEST(a,'::0'), GREATEST(a,'::f') FROM t1 ORDER BY a;
a	GREATEST(a,'::0')	GREATEST(a,'::f')
NULL	NULL	NULL
::1	::1	::f
::2	::2	::f
CREATE TABLE t2 AS SELECT
COALESCE(a, '::'),
LEAST(a,'::'),
GREATEST(a,'::')
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `COALESCE(a, '::')` inet6 DEFAULT NULL,
  `LEAST(a,'::')` inet6 DEFAULT NULL,
  `GREATEST(a,'::')` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
SELECT COALESCE(a, 0x00000000000000000000000000000000) FROM t1 ORDER BY a;
COALESCE(a, 0x00000000000000000000000000000000)
::
::1
::2
SELECT a,
LEAST(a, 0x00000000000000000000000000000000),
LEAST(a, 0x0000000000000000000000000000000f)
FROM t1 ORDER BY a;
a	LEAST(a, 0x00000000000000000000000000000000)	LEAST(a, 0x0000000000000000000000000000000f)
NULL	NULL	NULL
::1	::	::1
::2	::	::2
SELECT a,
GREATEST(a, 0x00000000000000000000000000000000),
GREATEST(a, 0x0000000000000000000000000000000f)
FROM t1 ORDER BY a;
a	GREATEST(a, 0x00000000000000000000000000000000)	GREATEST(a, 0x0000000000000000000000000000000f)
NULL	NULL	NULL
::1	::1	::f
::2	::2	::f
CREATE TABLE t2 AS SELECT
COALESCE(a, 0x00000000000000000000000000000000),
LEAST(a,0x00000000000000000000000000000000),
GREATEST(a,0x00000000000000000000000000000000)
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `COALESCE(a, 0x00000000000000000000000000000000)` inet6 DEFAULT NULL,
  `LEAST(a,0x00000000000000000000000000000000)` inet6 DEFAULT NULL,
  `GREATEST(a,0x00000000000000000000000000000000)` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
SELECT COALESCE(a, 10) FROM t1;
ERROR HY000: Illegal parameter data types inet6 and int for operation 'coalesce'
SELECT LEAST(a, 10) FROM t1;
ERROR HY000: Illegal parameter data types inet6 and int for operation 'least'
SELECT GREATEST(a, 10) FROM t1;
ERROR HY000: Illegal parameter data types inet6 and int for operation 'greatest'
DROP TABLE t1;
#
# Uniqueness
#
CREATE TABLE t1 (a INET6 NOT NULL PRIMARY KEY);
INSERT INTO t1 VALUES ('41::1'),('61::1');
INSERT INTO t1 VALUES ('41::1');
ERROR 23000: Duplicate entry '41::1' for key 'PRIMARY'
SELECT * FROM t1;
a
41::1
61::1
DROP TABLE t1;
#
# Indexes
#
CREATE TABLE t1 (a INET6, KEY(a(1)));
ERROR HY000: Incorrect prefix key; the used key part isn't a string, the used length is longer than the key part, or the storage engine doesn't support unique prefix keys
#
# Explicit CAST on INSERT
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES (CAST('1::1' AS INET6));
INSERT INTO t1 VALUES (CAST('1::2' AS INET6));
INSERT INTO t1 VALUES (CAST('1::3' AS INET6));
INSERT INTO t1 VALUES (CAST(CONCAT('2','::1') AS INET6));
INSERT INTO t1 VALUES (CAST(CONCAT('2','::2') AS INET6));
INSERT INTO t1 VALUES (CAST(CONCAT('2','::3') AS INET6));
SELECT * FROM t1 ORDER BY a;
a
1::1
1::2
1::3
2::1
2::2
2::3
DROP TABLE t1;
#
# Explicit CAST and implicit CAST on ALTER
#
CREATE TABLE t1 (a VARCHAR(64));
INSERT INTO t1 VALUES ('garbage'),('::'),('::1'),('ffff::1'),('ffff::2');
SELECT a, CAST(a AS INET6) FROM t1 ORDER BY a;
a	CAST(a AS INET6)
::	::
::1	::1
ffff::1	ffff::1
ffff::2	ffff::2
garbage	NULL
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
SELECT a, CAST(a AS INET6) FROM t1 ORDER BY CAST(a AS INET6);
a	CAST(a AS INET6)
garbage	NULL
::	::
::1	::1
ffff::1	ffff::1
ffff::2	ffff::2
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
Warning	1292	Incorrect inet6 value: 'garbage'
ALTER TABLE t1 MODIFY a INET6;
ERROR 22007: Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
SET sql_mode='';
ALTER TABLE t1 MODIFY a INET6;
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
SET sql_mode=DEFAULT;
SELECT * FROM t1 ORDER BY a;
a
NULL
::
::1
ffff::1
ffff::2
DROP TABLE t1;
CREATE TABLE t1 (a BINARY(16));
INSERT INTO t1 VALUES (0x00000000000000000000000000000000);
INSERT INTO t1 VALUES (0x00000000000000000000000000000001);
INSERT INTO t1 VALUES (0xffff0000000000000000000000000001);
INSERT INTO t1 VALUES (0xffff0000000000000000000000000002);
SELECT HEX(a), CAST(a AS INET6) FROM t1 ORDER BY a;
HEX(a)	CAST(a AS INET6)
00000000000000000000000000000000	::
00000000000000000000000000000001	::1
FFFF0000000000000000000000000001	ffff::1
FFFF0000000000000000000000000002	ffff::2
ALTER TABLE t1 MODIFY a INET6;
SELECT * FROM t1 ORDER BY a;
a
::
::1
ffff::1
ffff::2
DROP TABLE t1;
#
# INSERT..SELECT, same data types
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::1'),('::2');
CREATE TABLE t2 (a INET6);
INSERT INTO t2 SELECT a FROM t1;
SELECT * FROM t2;
a
::
::1
::2
DROP TABLE t1,t2;
#
# Implicit CAST on INSERT..SELECT, text format
#
CREATE TABLE t1 (a VARCHAR(64));
INSERT INTO t1 VALUES ('garbage'),('::'),('::1'),('ffff::1'),('ffff::2');
CREATE TABLE t2 (a INET6);
INSERT INTO t2 SELECT a FROM t1;
ERROR 22007: Incorrect inet6 value: 'garbage' for column `test`.`t2`.`a` at row 1
SET sql_mode='';
INSERT INTO t2 SELECT a FROM t1;
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t2`.`a` at row 1
SELECT * FROM t2 ORDER BY a;
a
NULL
::
::1
ffff::1
ffff::2
SET sql_mode=DEFAULT;
DROP TABLE t2;
CREATE TABLE t2 (a INET6 NOT NULL);
INSERT INTO t2 SELECT a FROM t1;
ERROR 22007: Incorrect inet6 value: 'garbage' for column `test`.`t2`.`a` at row 1
SET sql_mode='';
INSERT INTO t2 SELECT a FROM t1;
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t2`.`a` at row 1
SELECT * FROM t2 ORDER BY a;
a
::
::
::1
ffff::1
ffff::2
SET sql_mode=DEFAULT;
DROP TABLE t2;
DROP TABLE t1;
#
# Implicit CAST on INSERT..SELECT, binary format
#
CREATE TABLE t1 (a BINARY(16));
INSERT INTO t1 VALUES (0x00000000000000000000000000000000);
INSERT INTO t1 VALUES (0x00000000000000000000000000000001);
INSERT INTO t1 VALUES (0xffff0000000000000000000000000001);
INSERT INTO t1 VALUES (0xffff0000000000000000000000000002);
CREATE TABLE t2 (a INET6);
INSERT INTO t2 SELECT a FROM t1;
SELECT a FROM t2 ORDER BY a;
a
::
::1
ffff::1
ffff::2
DROP TABLE t1,t2;
#
# CAST to other data types
#
SELECT CAST(CAST('::' AS INET6) AS DOUBLE);
ERROR HY000: Illegal parameter data type inet6 for operation 'double_typecast'
SELECT CAST(CAST('::' AS INET6) AS DECIMAL);
ERROR HY000: Illegal parameter data type inet6 for operation 'decimal_typecast'
SELECT CAST(CAST('::' AS INET6) AS SIGNED);
ERROR HY000: Illegal parameter data type inet6 for operation 'cast_as_signed'
SELECT CAST(CAST('::' AS INET6) AS UNSIGNED);
ERROR HY000: Illegal parameter data type inet6 for operation 'cast_as_unsigned'
SELECT CAST(CAST('::' AS INET6) AS TIME);
ERROR HY000: Illegal parameter data type inet6 for operation 'cast_as_time'
SELECT CAST(CAST('::' AS INET6) AS DATE);
ERROR HY000: Illegal parameter data type inet6 for operation 'cast_as_date'
SELECT CAST(CAST('::' AS INET6) AS DATETIME);
ERROR HY000: Illegal parameter data type inet6 for operation 'cast_as_datetime'
SELECT CAST(CAST('::' AS INET6) AS CHAR);
CAST(CAST('::' AS INET6) AS CHAR)
::
CREATE TABLE t1 AS SELECT CAST(CAST('::' AS INET6) AS CHAR) AS a;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` varchar(39) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t1;
#
# Implicit conversion to other types in INSERT
#
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (CAST('::' AS INET6));
ERROR 22007: Incorrect integer value: '::' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
CREATE TABLE t1 (a DOUBLE);
INSERT INTO t1 VALUES (CAST('::' AS INET6));
ERROR 22007: Incorrect double value: '::' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
CREATE TABLE t1 (a DECIMAL(32,0));
INSERT INTO t1 VALUES (CAST('::' AS INET6));
ERROR 22007: Incorrect decimal value: '::' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
CREATE TABLE t1 (a VARCHAR(64));
INSERT INTO t1 VALUES (CAST('::' AS INET6));
DROP TABLE t1;
CREATE TABLE t1 (a TEXT);
INSERT INTO t1 VALUES (CAST('::' AS INET6));
DROP TABLE t1;
#
# Boolean context
#
SELECT
CAST('::' AS INET6) IS TRUE, 
CAST('::' AS INET6) IS FALSE,
CAST('::1' AS INET6) IS TRUE,
CAST('::1' AS INET6) IS FALSE;
CAST('::' AS INET6) IS TRUE	CAST('::' AS INET6) IS FALSE	CAST('::1' AS INET6) IS TRUE	CAST('::1' AS INET6) IS FALSE
0	1	1	0
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::1');
SELECT a, a IS TRUE, a IS FALSE FROM t1 ORDER BY a;
a	a IS TRUE	a IS FALSE
::	0	1
::1	1	0
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::1'),('::2');
SELECT * FROM t1 WHERE a;
ERROR HY000: Illegal parameter data types inet6 and bigint for operation '<>'
DROP TABLE t1;
#
# GROUP BY
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::');
INSERT INTO t1 VALUES ('::1'),('::01'),('::0001');
INSERT INTO t1 VALUES ('::2'),('::2'),('::2'),('::2');
SELECT a, COUNT(*) FROM t1 GROUP BY a;
a	COUNT(*)
::	2
::1	3
::2	4
DROP TABLE t1;
#
# Aggregate functions
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::');
INSERT INTO t1 VALUES ('::1'),('::01'),('::0001');
INSERT INTO t1 VALUES ('::2'),('::2'),('::2'),('::2');
SELECT MIN(a),MAX(a) FROM t1;
MIN(a)	MAX(a)
::	::2
CREATE TABLE t2 AS SELECT MIN(a), MAX(a) FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `MIN(a)` inet6 DEFAULT NULL,
  `MAX(a)` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
SELECT AVG(a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'avg('
SELECT AVG(DISTINCT a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'avg(distinct '
SELECT SUM(a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'sum('
SELECT SUM(DISTINCT a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'sum(distinct '
SELECT STDDEV(a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'std('
SELECT GROUP_CONCAT(a ORDER BY a) FROM t1;
GROUP_CONCAT(a ORDER BY a)
::,::,::1,::1,::1,::2,::2,::2,::2
SELECT a, GROUP_CONCAT(a ORDER BY a) FROM t1 GROUP BY a;
a	GROUP_CONCAT(a ORDER BY a)
::	::,::
::1	::1,::1,::1
::2	::2,::2,::2,::2
DROP TABLE t1;
#
# Window functions
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::1'),('::2'),('::3'),('::4');
SELECT
a,
LAG(a) OVER (ORDER BY a),
LEAD(a) OVER (ORDER BY a)
FROM t1 ORDER BY a;
a	LAG(a) OVER (ORDER BY a)	LEAD(a) OVER (ORDER BY a)
::1	NULL	::2
::2	::1	::3
::3	::2	::4
::4	::3	NULL
SELECT
a,
FIRST_VALUE(a) OVER (ORDER BY a ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING),
LAST_VALUE(a) OVER (ORDER BY a ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)
FROM t1 ORDER BY a;
a	FIRST_VALUE(a) OVER (ORDER BY a ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)	LAST_VALUE(a) OVER (ORDER BY a ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)
::1	::1	::2
::2	::1	::3
::3	::2	::4
::4	::3	::4
DROP TABLE t1;
#
# Prepared statements
#
EXECUTE IMMEDIATE 'CREATE TABLE t1 AS SELECT ? AS a' USING CAST('::' AS INET6);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` inet6 NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
EXECUTE IMMEDIATE 'INSERT INTO t1 VALUES (?)' USING '::1';
EXECUTE IMMEDIATE 'INSERT INTO t1 VALUES (?)' USING CAST('::2' AS INET6);
EXECUTE IMMEDIATE 'INSERT INTO t1 VALUES (?)' USING 0x00000000000000000000000000000003;
SELECT a FROM t1 ORDER BY a;
a
::
::1
::2
::3
EXECUTE IMMEDIATE 'SELECT * FROM t1 WHERE a=?' USING '::1';
a
::1
EXECUTE IMMEDIATE 'SELECT * FROM t1 WHERE a=?' USING CAST('::2' AS INET6);
a
::2
EXECUTE IMMEDIATE 'SELECT * FROM t1 WHERE a=?' USING 0x00000000000000000000000000000003;
a
::3
DROP TABLE t1;
#
# Range optimizer
#
CREATE TABLE t1 (a INET6, INDEX(a));
FOR i IN 0..255
DO
INSERT INTO t1 VALUES (CONCAT('::', HEX(i)));
END FOR
$$
SELECT * FROM t1 WHERE a='::ff';
a
::ff
EXPLAIN SELECT * FROM t1 WHERE a='::ff';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ref	a	a	17	const	1	Using where; Using index
SELECT * FROM t1 WHERE a='garbage';
a
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
EXPLAIN SELECT * FROM t1 WHERE a='garbage';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	NULL	NULL	NULL	NULL	NULL	NULL	NULL	Impossible WHERE noticed after reading const tables
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
SELECT * FROM t1 WHERE a>='::fe';
a
::fe
::ff
EXPLAIN SELECT * FROM t1 WHERE a>='::fe';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	a	a	17	NULL	2	Using where; Using index
SELECT * FROM t1 WHERE a>='garbage';
a
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
EXPLAIN SELECT * FROM t1 WHERE a>='garbage';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	NULL	NULL	NULL	NULL	NULL	NULL	NULL	Impossible WHERE noticed after reading const tables
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
SELECT * FROM t1 WHERE a IN ('::80','::a0','::f0');
a
::80
::a0
::f0
EXPLAIN SELECT * FROM t1 WHERE a IN ('::80','::a0','::f0');
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	a	a	17	NULL	3	Using where; Using index
SELECT * FROM t1 WHERE a IN ('::80','::a0','garbage');
a
::80
::a0
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
EXPLAIN SELECT * FROM t1 WHERE a IN ('::80','::a0','garbage');
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	a	a	17	NULL	2	Using where; Using index
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
SELECT * FROM t1 WHERE a BETWEEN '::80' AND '::81';
a
::80
::81
EXPLAIN SELECT * FROM t1 WHERE a BETWEEN '::80' AND '::81';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	a	a	17	NULL	2	Using where; Using index
SELECT * FROM t1 WHERE a BETWEEN '::80' AND 'garbage';
a
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
EXPLAIN SELECT * FROM t1 WHERE a BETWEEN '::80' AND 'garbage';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	NULL	NULL	NULL	NULL	NULL	NULL	NULL	Impossible WHERE noticed after reading const tables
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
SELECT * FROM t1 WHERE a=CAST('::ff' AS INET6);
a
::ff
EXPLAIN EXTENDED SELECT * FROM t1 WHERE a=CAST('::ff' AS INET6);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	SIMPLE	t1	ref	a	a	17	const	1	100.00	Using where; Using index
Warnings:
Note	1003	select `test`.`t1`.`a` AS `a` from `test`.`t1` where `test`.`t1`.`a` = <cache>(cast('::ff' as inet6))
DROP TABLE t1;
#
# Character set and collation aggregation
#
CREATE TABLE t1 (a INET6);
CREATE TABLE t2 AS SELECT
CONCAT(a) AS c1,
CONCAT(CAST('::' AS INET6)) AS c2
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `c1` varchar(39) DEFAULT NULL,
  `c2` varchar(39) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
CREATE TABLE t2 AS SELECT
CONCAT(_utf8'1', a) AS c1,
CONCAT(_utf8'1', CAST('::1' AS INET6)) AS c2,
CONCAT(_utf8'1', COALESCE(a)) AS c3
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `c1` varchar(40) CHARACTER SET utf8 DEFAULT NULL,
  `c2` varchar(40) CHARACTER SET utf8 DEFAULT NULL,
  `c3` varchar(40) CHARACTER SET utf8 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
CREATE TABLE t2 AS SELECT
CONCAT(_latin1'1', a) AS c1,
CONCAT(_latin1'1', CAST('::1' AS INET6)) AS c2,
CONCAT(_latin1'1', COALESCE(a)) AS c3
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `c1` varchar(40) DEFAULT NULL,
  `c2` varchar(40) DEFAULT NULL,
  `c3` varchar(40) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
DROP TABLE t1;
#
# UNION
#
CREATE TABLE t1 AS SELECT CAST('::' AS INET6) AS c UNION SELECT CAST('::1' AS INET6);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c` inet6 NOT NULL DEFAULT '::'
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t1;
CREATE TABLE t1 AS SELECT CAST('::' AS INET6) AS c UNION SELECT '::1';
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c` inet6 NOT NULL DEFAULT '::'
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t1;
CREATE TABLE t1 AS SELECT '::' AS c UNION SELECT CAST('::1' AS INET6);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c` inet6 NOT NULL DEFAULT '::'
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t1;
CREATE TABLE t1 AS SELECT CAST('::' AS INET6) AS c UNION SELECT 0x00000000000000000000000000000001;
SELECT * FROM t1;
c
::
::1
DROP TABLE t1;
CREATE TABLE t1 AS SELECT CAST('::' AS INET6) AS c UNION SELECT 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation 'UNION'
#
# Unary operators
#
SELECT -CAST('::' AS INET6);
ERROR HY000: Illegal parameter data type inet6 for operation '-'
SELECT ABS(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'abs'
SELECT ROUND(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'round'
SELECT CEILING(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'ceiling'
SELECT FLOOR(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'floor'
#
# Arithmetic operators
#
SELECT CAST('::' AS INET6) + 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation '+'
SELECT CAST('::' AS INET6) - 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation '-'
SELECT CAST('::' AS INET6) * 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation '*'
SELECT CAST('::' AS INET6) / 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation '/'
SELECT CAST('::' AS INET6) MOD 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation 'MOD'
#
# Misc
#
SELECT RAND(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'rand'
SELECT FROM_UNIXTIME(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'from_unixtime'
SELECT HOUR(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'hour'
SELECT YEAR(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'year'
SELECT RELEASE_LOCK(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'release_lock'
SELECT JSON_LENGTH(CAST('::' AS INET6));
JSON_LENGTH(CAST('::' AS INET6))
NULL
Warnings:
Warning	4038	Syntax error in JSON text in argument 1 to function 'json_length' at position 1
#
# Virtual columns
#
CREATE TABLE t1 (
a INT,
b INET6 GENERATED ALWAYS AS (CAST(CONCAT(RAND(),a) AS INET6)), INDEX(b)
);
ERROR HY000: Function or expression 'rand()' cannot be used in the GENERATED ALWAYS AS clause of `b`
CREATE TABLE t1 (
a INT,
b INET6 GENERATED ALWAYS AS (CAST(CONCAT('::',HEX(a)) AS INET6)), INDEX(b)
);
INSERT INTO t1 (a) VALUES (0),(1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15);
SELECT * FROM t1;
a	b
0	::
1	::1
2	::2
3	::3
4	::4
5	::5
6	::6
7	::7
8	::8
9	::9
10	::a
11	::b
12	::c
13	::d
14	::e
15	::f
DROP TABLE t1;
#
# VIEW
#
CREATE TABLE t1 (a INT DEFAULT 0);
INSERT INTO t1 (a) VALUES (0),(1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15);
SELECT * FROM t1 ORDER BY a;
a
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
CREATE VIEW v1 AS SELECT (CAST(CONCAT('::',HEX(a)) AS INET6)) AS c FROM t1;
SELECT * FROM v1 ORDER BY c;
c
::
::1
::2
::3
::4
::5
::6
::7
::8
::9
::a
::b
::c
::d
::e
::f
DROP VIEW v1;
DROP TABLE t1;
CREATE TABLE t1 (a INET6 DEFAULT '::');
CREATE VIEW v1 AS SELECT * FROM t1;
SHOW CREATE VIEW v1;
View	Create View	character_set_client	collation_connection
v1	CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v1` AS select `t1`.`a` AS `a` from `t1`	latin1	latin1_swedish_ci
DESCRIBE v1;
Field	Type	Null	Key	Default	Extra
a	inet6	YES		::	
INSERT INTO v1 VALUES ('::'),('::1'),('::2');
SELECT * FROM t1;
a
::
::1
::2
DROP VIEW v1;
DROP TABLE t1;
CREATE TABLE t1 (a INET6 DEFAULT CAST('::' AS INET6));
CREATE VIEW v1 AS SELECT * FROM t1;
SHOW CREATE VIEW v1;
View	Create View	character_set_client	collation_connection
v1	CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v1` AS select `t1`.`a` AS `a` from `t1`	latin1	latin1_swedish_ci
DESCRIBE v1;
Field	Type	Null	Key	Default	Extra
a	inet6	YES		cast('::' as inet6)	
INSERT INTO v1 VALUES ('::'),('::1'),('::2');
SELECT * FROM t1;
a
::
::1
::2
DROP VIEW v1;
DROP TABLE t1;
#
# Subqueries
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::1'),('::2');
SELECT * FROM t1 WHERE a=(SELECT MIN(a) FROM t1) ORDER BY a;
a
::
SELECT * FROM t1 WHERE a=(SELECT MAX(a) FROM t1) ORDER BY a;
a
::2
SELECT * FROM t1 WHERE a IN (SELECT a FROM t1 WHERE a>'::') ORDER BY a;
a
::1
::2
DROP TABLE t1;
#
# Stored routines
#
CREATE PROCEDURE p1(a INET6)
BEGIN
DECLARE b INET6 DEFAULT CONCAT('1', a);
SELECT a, b;
END;
$$
CALL p1('::1');
a	b
::1	1::1
CALL p1(CAST('::2' AS INET6));
a	b
::2	1::2
DROP PROCEDURE p1;
CREATE FUNCTION f1(a INET6) RETURNS INET6
BEGIN
RETURN CONCAT('1',a);
END;
$$
SELECT f1('::1');
f1('::1')
1::1
SELECT f1(CAST('::1' AS INET6));
f1(CAST('::1' AS INET6))
1::1
DROP FUNCTION f1;
#
# Anchored data types in SP variables
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::1');
CREATE PROCEDURE p1()
BEGIN
DECLARE va TYPE OF t1.a;
SELECT MAX(a) INTO va FROM t1;
SELECT va;
END;
$$
CALL p1;
va
::1
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b INET6);
INSERT INTO t1 VALUES ('::a', '::b');
CREATE PROCEDURE p1()
BEGIN
DECLARE va ROW TYPE OF t1;
SELECT MAX(a), MAX(b) INTO va FROM t1;
SELECT va.a, va.b;
END;
$$
CALL p1;
va.a	va.b
::a	::b
DROP PROCEDURE p1;
DROP TABLE t1;
